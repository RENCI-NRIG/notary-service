{% extends 'base.html' %}
{% load static dataset_tags user_tags %}

{% block title %}Infrastructure for Privacy-Assured CompuTations{% endblock %}

{% block content %}
  {% if user.is_authenticated %}
    {% display_templates as show_templates %}
    {% if show_templates %}
      <link rel="stylesheet" href="{% static 'css/profile.css' %}">
      <div class="container">
        <h1 class="mt-4">Templates</h1>
        <p>
          Templates are directed acyclic graphs (DAGs) that provide the basis for permission
          based workflows. The graphs are defined using graphml and are stored in a Neo4j database.
        </p>
        <div class="d-flex flex-row align-items-center justify-content-between">
          <h2 class="mt-2">My Templates</h2>
          {% if user.is_dp or user.is_nsadmin %}
            <button class="btn btn-success mr-0">
              <i class="fa fa-plus mr-2"></i>
              <a href="{% url 'template_new' %}" class="unlink">Create New Template</a>
            </button>
          {% endif %}
        </div>
        <table class="collapse show table table-striped table-bordered text-center mt-2">
          <tr class="font-weight-bold">
            <td>Name</td>
            <td>Type</td>
            <td>Validated</td>
            <td>
              {% if user.show_uuid %}
                UUID
              {% else %}
                Description
              {% endif %}
            </td>
            <td>Created Date</td>
            <td>Modified Date</td>
          </tr>
          {% for template in templates %}
            <tr>
              <td>{{ template.name }}</td>
              <td>{{ template.type }}</td>
              <td>{% if template.is_valid %}
                <i class="fa fa-fw fa-check text-success"></i>
              {% else %}
                <i class="fa fa-fw fa-remove text-danger"></i>
              {% endif %}
              </td>
              <td class="courier-font-link">
                <a
                  href="{% url 'template_detail' uuid=template.uuid %}"
                  title="Template Details"
                >
                  {% if user.show_uuid %}
                    {{ template.uuid }}
                  {% else %}
                    {{ template.description|truncatechars:"57" }}
                  {% endif %}
                </a>
              </td>
              <td>{{ template.created_date|date:"m/d/Y g:i a" }}</td>
              <td>{{ template.modified_date|date:"m/d/Y g:i a" }}</td>
              <td>
              {% if user.is_dp or user.is_nsadmin %}
                <button class="btn btn-success mr-0">
                  <i class="fa fa-pencil mr-2"></i>
                  <a href="{% url 'template_edit' uuid=template.uuid %}" class="unlink">Edit</a>
                </button>
              {% endif %}
              </td>
            </tr>
          {% endfor %}
        </table>
      </div>
    {% endif %}
    {% else %}
      <div class="container">
        <p>You are not currently logged in or not authorized to view this page</p>
      </div>
    {% endif %}
{% endblock %}